{% extends 'MonCal/base.html' %}

{% block content %}

<h2>行事新規登録</h2>
<h2><a href="{% url 'MonCal:event_list' %}">スケジュール一覧へ</a></h2>
    <table   style="border-collapse: collapse" id="calender">
        <caption>
            <a href="{% url 'MonCal:eventcalendar'%}">行事新規登録</a>
            <br>{{ start_day }} - {{ end_day }}
        </caption>
        <thead>
            <tr class="cal_head_row" >
                <th width="7%">
                    <a href="{% url 'MonCal:eventcalendar' before.year before.month before.day %}">前週</a>
                    <br>
                    <a href="{% url 'MonCal:eventcalendar' next.year next.month next.day %}">次週</a>
                </th>
                {% for time in times %}
                <th class="headers_time" colspan='{{time_span}}'>{{ time }}</th>
                {% endfor %}
                <th class="headers_time">{{tailtime}}</th>
            </tr>
        </thead>
        <tbody>
            <tr  class ="cellstime">
                <td></td>
                {% for time in input_times %}
                <td>{{ time| date:'H:i' }}</td>
                {% endfor %}
                <td>{{tailtime| date:'H:i'}}</td>
            </tr>
        {% for day, shcelist in calendar.items %}
            <tr  class="eventcal-tr">
                <th rowspan="{{shcelist.date_span}}" hight="14" class="date_col">
                    {% if day in workingday_list %}
                        {% if day.weekday < 5 %}
                        <div style="color: green;" >非稼働日<br>
                        {% else %}
                        <div>稼働日<br>
                        {% endif %}
                    {% elif day.weekday == 5 %}
                        <div style="color: blue;" >
                    {% elif day.weekday == 6 %}
                        <div style="color: red;" >
                    {% else %}
                        <div>
                    {% endif %}
                    {{ day| date:"d(D)" }}</div>
                </th>
                {% if day.weekday >= 5 and day not in workingday_list or day.weekday < 5 and day in workingday_list %}
                    {% for time in input_times %}
                    <td bgcolor="#d3d3d3" 
                        {% if time in times %}
                            class="scale_time"
                        {% endif %}
                        onmouseover="ev_mouse_over(this,'{{tailtime| date:'H:i'}}')"  ></td>
                    {% endfor %} 
                {% else %}
                    {% for time in input_times %}
                    <td  bgcolor="#d9e5ff" onmouseover="ev_mouse_over(this,'{{tailtime| date:'H:i'}}')" 
                        onMouseDown="ev_intime(this,'{{day| date:'Y-m-d'}}','{{tailtime| date:'H:i'}}')"  
                        {% if time in times %}
                            class="scale_time"
                        {% endif %}
                    ></td>
                    {% endfor %}   
                {% endif %}
                <th rowspan="{{shcelist.date_span}}" class="date_col">
                    {% if day in workingday_list %}
                        {% if day.weekday < 5 %}
                        <div style="color: green;" >非稼働日<br>
                        {% else %}
                        <div>稼働日<br>
                        {% endif %}
                    {% elif day.weekday == 5 %}
                        <div style="color: blue;" >
                    {% elif day.weekday == 6 %}
                        <div style="color: red;" >
                    {% else %}
                        <div>
                    {% endif %}
                    {{ day| date:"d(D)" }}</div>
                </th>
            </tr>
            {% for shce in shcelist.shce_list %}
                <tr class="cal_sche_row" >
                    
                    {% if day.weekday >= 5 and day not in workingday_list or day.weekday < 5 and day in workingday_list %}
                        {% for time, book in shce.items %}
                        <td bgcolor="#d3d3d3" 
                            {% if time in times %}
                                class="scale_time"
                            {% endif %}
                        ></td>
                        {% endfor %} 
                    {% else %}
                    
                        {% for time, book in shce.items %}
                            {% if book == 'Nothing' %}
                                <td
                                    {% if time in times %}
                                        class="scale_time"
                                    {% endif %}
                                ></td>
                            {% elif book == 'same' %}
                            {% else %}
                                <td bgcolor="#d3d3d3" 
                                    {% if time in times %}
                                        class="scale_time sche_box"
                                    {% else %}
                                        class="sche_box"
                                    {% endif %}
                                colspan='{{book.col_span}}'>
                                    {% if book.schedule.cycle_type.code != 'nocycle' %}
                                        <a href="{% url 'MonCal:event_cycle_edit' book.schedule.pk day.year day.month day.day %}">
                                    {% else %}
                                        <a href="{% url 'MonCal:Event_detail' book.schedule.pk %}">
                                    {% endif %}
                                    {{book.schedule.title}} 
                                    {% for place in book.schedule.place.all %}
                                        {{place}}
                                    {% endfor %}
                                    <br>使用施設
                                    {% for room in book.schedule.room.all %}
                                        {{room}}
                                    {% empty %}
                                        なし
                                    {% endfor %}
                                </a></td>
                            {% endif %}
                        {% endfor %} 
                        
                    {% endif %}
                </tr>
            {% endfor %} 
        {% endfor %}
        </tbody>
    </table>
    
    <form action="" method="POST">
        <table border="0" width="70%">
            <tr>
                <td valign="top">
                    {% for field in form %}
                    {% if field.id_for_label == 'id_starttime' or field.id_for_label == 'id_endtime' or field.id_for_label == 'id_date'  or field.id_for_label == 'id_cycle_type' or field.id_for_label == 'id_cycle_stopday' %}
                        {% if field.id_for_label == 'id_starttime' %}
                            <p id ="s_timetext">{{field.label}}:</p>
                            <p class ="timeform">
                        {% elif field.id_for_label == 'id_endtime' %}
                            <p id ="e_timetext">{{field.label}}:</p>
                            <p class ="timeform" >
                        {% elif  field.id_for_label == 'id_date' or field.id_for_label == 'id_cycle_type'  or field.id_for_label == 'id_cycle_stopday' %}
                            <p>
                        {% endif %}
                            {{field.label_tag}}
                            {{field}}
                        {% for error in field.errors %}
                            {{error}}
                        {% endfor %}
                        </p>
                    {% endif %}
                    {% endfor %}
                </td>
                <td valign="top">
                    {% for field in form %}
                        {% if field.label == '場所' %}

                            {{field.label_tag}}
                            {% for choice in field %}
                                <br> 
                                {{ choice.tag }}
                                {{ choice.choice_label }}
                            {% endfor %}

                            {% for error in field.errors %}
                                {{error}}
                            {% endfor %} 
                           
                        {% endif %}
                    {% endfor %}
                </td>
                <td valign="top">
                    {% for field in form %}
                        {% if field.label == '設備' %}

                            {{field.label_tag}}
                            {% for choice in field %}
                                <br>
                                {{ choice.tag }}
                                {{ choice.choice_label }}
                            {% endfor %}

                            {% for error in field.errors %}
                                {{error}}
                            {% endfor %} 
                            
                        {% endif %}
                    {% endfor %}
                </td>
                <td valign="top">
                    {% for field in form %}
                        {% if field.id_for_label == 'id_title' or field.id_for_label == 'id_detail' %}
                        <p>
                            {{field.label_tag}}
                            {{field}}
                            {% for error in field.errors %}
                                {{error}}
                            {% endfor %}
                        </p>
                        {% endif %}
                    {% endfor %}
                </td>
            </tr>
            <tr><td></td>
                <td>
                    {% csrf_token %}
                    <button type="submit">登録</button>
                    <button type="reset" onclick="reset_timeform()">取消</button>
                </td>
            </tr>
        </table> 
    </form>
{% endblock %}